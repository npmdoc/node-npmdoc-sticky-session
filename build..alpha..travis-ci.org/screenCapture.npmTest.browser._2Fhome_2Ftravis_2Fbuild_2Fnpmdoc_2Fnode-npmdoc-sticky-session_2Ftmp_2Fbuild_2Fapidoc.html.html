<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a>sticky-session (v1.1.2)</a>
</h1>
<h4>Sticky session balancer based on a `cluster` module</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.sticky-session">module sticky-session</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master">
            function <span class="apidocSignatureSpan">sticky-session.</span>Master
            <span class="apidocSignatureSpan">(workerCount, env)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_">
            function <span class="apidocSignatureSpan">sticky-session.</span>Master.super_
            <span class="apidocSignatureSpan">(options, connectionListener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.listen">
            function <span class="apidocSignatureSpan">sticky-session.</span>listen
            <span class="apidocSignatureSpan">(server, port, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sticky-session.</span>Master.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sticky-session.</span>Master.super_.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sticky-session.Master">module sticky-session.Master</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.Master">
            function <span class="apidocSignatureSpan">sticky-session.</span>Master
            <span class="apidocSignatureSpan">(workerCount, env)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_">
            function <span class="apidocSignatureSpan">sticky-session.Master.</span>super_
            <span class="apidocSignatureSpan">(options, connectionListener)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sticky-session.Master.prototype">module sticky-session.Master.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.prototype.balance">
            function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>balance
            <span class="apidocSignatureSpan">(socket)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.prototype.hash">
            function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>hash
            <span class="apidocSignatureSpan">(ip)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.prototype.respawn">
            function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>respawn
            <span class="apidocSignatureSpan">(worker)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.prototype.spawnWorker">
            function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>spawnWorker
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sticky-session.Master.super_">module sticky-session.Master.super_</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.super_">
            function <span class="apidocSignatureSpan">sticky-session.Master.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sticky-session.Master.super_.prototype">module sticky-session.Master.super_.prototype</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>listening</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype._emitCloseIfDrained">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>_emitCloseIfDrained
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype._listen2">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>_listen2
            <span class="apidocSignatureSpan">(address, port, addressType, backlog, fd)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype._setupSlave">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>_setupSlave
            <span class="apidocSignatureSpan">(socketList)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.address">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>address
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.close">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.getConnections">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>getConnections
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.listen">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>listen
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.listenFD">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>listenFD
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.ref">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>ref
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sticky-session.Master.super_.prototype.unref">
            function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>unref
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sticky-session" id="apidoc.module.sticky-session">module sticky-session</a></h1>


    <h2>
        <a href="#apidoc.element.sticky-session.Master" id="apidoc.element.sticky-session.Master">
        function <span class="apidocSignatureSpan">sticky-session.</span>Master
        <span class="apidocSignatureSpan">(workerCount, env)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Master(workerCount, env) {
  net.Server.call(this, {
    pauseOnConnect: true
  }, this.balance);

  this.env = env || {};

  this.seed = (Math.random() * 0xffffffff) | 0;
  this.workers = [];

  debug('master seed=%d', this.seed);

  this.once('listening', function() {
    debug('master listening on %j', this.address());

    for (var i = 0; i &lt; workerCount; i++)
      this.spawnWorker();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_" id="apidoc.element.sticky-session.Master.super_">
        function <span class="apidocSignatureSpan">sticky-session.</span>Master.super_
        <span class="apidocSignatureSpan">(options, connectionListener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Server(options, connectionListener) {
  if (!(this instanceof Server))
    return new Server(options, connectionListener);

  EventEmitter.call(this);

  if (typeof options === 'function') {
    connectionListener = options;
    options = {};
    this.on('connection', connectionListener);
  } else if (options == null || typeof options === 'object') {
    options = options || {};

    if (typeof connectionListener === 'function') {
      this.on('connection', connectionListener);
    }
  } else {
    throw new TypeError('options must be an object');
  }

  this._connections = 0;

  Object.defineProperty(this, 'connections', {
    get: internalUtil.deprecate(() =&gt; {

      if (this._usingSlaves) {
        return null;
      }
      return this._connections;
    }, 'Server.connections property is deprecated. ' +
       'Use Server.getConnections method instead.'),
    set: internalUtil.deprecate((val) =&gt; {
      return (this._connections = val);
    }, 'Server.connections property is deprecated.'),
    configurable: true, enumerable: false
  });

  this._handle = null;
  this._usingSlaves = false;
  this._slaves = [];
  this._unref = false;

  this.allowHalfOpen = options.allowHalfOpen || false;
  this.pauseOnConnect = !!options.pauseOnConnect;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.listen" id="apidoc.element.sticky-session.listen">
        function <span class="apidocSignatureSpan">sticky-session.</span>listen
        <span class="apidocSignatureSpan">(server, port, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listen(server, port, options) {
  if (!options)
    options = {};

  if (cluster.isMaster) {
    var workerCount = options.workers || os.cpus().length;

    var master = new Master(workerCount, options.env);
    master.listen(port);
    master.once('listening', function() {
      server.emit('listening');
    });
    return false;
  }

  // Override close callback to gracefully close server
  var oldClose = server.close;
  server.close = function close() {
    debug('graceful close');
    process.send({ type: 'close' });
    return oldClose.apply(this, arguments);
  };

  process.on('message', function(msg, socket) {
    if (msg !== 'sticky:balance' || !socket)
      return;

    debug('incoming socket');
    server._connections++;
    socket.server = server;
    server.emit('connection', socket);
  });
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var cluster = require('cluster'); // Only required if you want the worker id
var sticky = require('sticky-session');

var server = require('http').createServer(function(req, res) {
  res.end('worker: ' + cluster.worker.id);
});

if (!sticky.<span class="apidocCodeKeywordSpan">listen</span>(server, 3000)) {
  // Master code
  server.once('listening', function() {
    console.log('server started on 3000 port');
  });
} else {
  // Worker code
}
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sticky-session.Master" id="apidoc.module.sticky-session.Master">module sticky-session.Master</a></h1>


    <h2>
        <a href="#apidoc.element.sticky-session.Master.Master" id="apidoc.element.sticky-session.Master.Master">
        function <span class="apidocSignatureSpan">sticky-session.</span>Master
        <span class="apidocSignatureSpan">(workerCount, env)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Master(workerCount, env) {
  net.Server.call(this, {
    pauseOnConnect: true
  }, this.balance);

  this.env = env || {};

  this.seed = (Math.random() * 0xffffffff) | 0;
  this.workers = [];

  debug('master seed=%d', this.seed);

  this.once('listening', function() {
    debug('master listening on %j', this.address());

    for (var i = 0; i &lt; workerCount; i++)
      this.spawnWorker();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_" id="apidoc.element.sticky-session.Master.super_">
        function <span class="apidocSignatureSpan">sticky-session.Master.</span>super_
        <span class="apidocSignatureSpan">(options, connectionListener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Server(options, connectionListener) {
  if (!(this instanceof Server))
    return new Server(options, connectionListener);

  EventEmitter.call(this);

  if (typeof options === 'function') {
    connectionListener = options;
    options = {};
    this.on('connection', connectionListener);
  } else if (options == null || typeof options === 'object') {
    options = options || {};

    if (typeof connectionListener === 'function') {
      this.on('connection', connectionListener);
    }
  } else {
    throw new TypeError('options must be an object');
  }

  this._connections = 0;

  Object.defineProperty(this, 'connections', {
    get: internalUtil.deprecate(() =&gt; {

      if (this._usingSlaves) {
        return null;
      }
      return this._connections;
    }, 'Server.connections property is deprecated. ' +
       'Use Server.getConnections method instead.'),
    set: internalUtil.deprecate((val) =&gt; {
      return (this._connections = val);
    }, 'Server.connections property is deprecated.'),
    configurable: true, enumerable: false
  });

  this._handle = null;
  this._usingSlaves = false;
  this._slaves = [];
  this._unref = false;

  this.allowHalfOpen = options.allowHalfOpen || false;
  this.pauseOnConnect = !!options.pauseOnConnect;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sticky-session.Master.prototype" id="apidoc.module.sticky-session.Master.prototype">module sticky-session.Master.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.sticky-session.Master.prototype.balance" id="apidoc.element.sticky-session.Master.prototype.balance">
        function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>balance
        <span class="apidocSignatureSpan">(socket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function balance(socket) {
  var addr = ip.toBuffer(socket.remoteAddress || '127.0.0.1');
  var hash = this.hash(addr);

  debug('balacing connection %j', addr);
  this.workers[hash % this.workers.length].send('sticky:balance', socket);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.prototype.hash" id="apidoc.element.sticky-session.Master.prototype.hash">
        function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>hash
        <span class="apidocSignatureSpan">(ip)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function hash(ip) {
  var hash = this.seed;
  for (var i = 0; i &lt; ip.length; i++) {
    var num = ip[i];

    hash += num;
    hash %= 2147483648;
    hash += (hash &lt;&lt; 10);
    hash %= 2147483648;
    hash ^= hash &gt;&gt; 6;
  }

  hash += hash &lt;&lt; 3;
  hash %= 2147483648;
  hash ^= hash &gt;&gt; 11;
  hash += hash &lt;&lt; 15;
  hash %= 2147483648;

  return hash &gt;&gt;&gt; 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.prototype.respawn" id="apidoc.element.sticky-session.Master.prototype.respawn">
        function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>respawn
        <span class="apidocSignatureSpan">(worker)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function respawn(worker) {
  var index = this.workers.indexOf(worker);
  if (index !== -1)
    this.workers.splice(index, 1);
  this.spawnWorker();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.prototype.spawnWorker" id="apidoc.element.sticky-session.Master.prototype.spawnWorker">
        function <span class="apidocSignatureSpan">sticky-session.Master.prototype.</span>spawnWorker
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function spawnWorker() {
  var worker = cluster.fork(this.env);

  var self = this;
  worker.on('exit', function(code) {
    debug('worker=%d died with code=%d', worker.process.pid, code);
    self.respawn(worker);
  });

  worker.on('message', function(msg) {
    // Graceful exit
    if (msg.type === 'close')
      self.respawn(worker);
  });

  debug('worker=%d spawn', worker.process.pid);
  this.workers.push(worker);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sticky-session.Master.super_" id="apidoc.module.sticky-session.Master.super_">module sticky-session.Master.super_</a></h1>


    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.super_" id="apidoc.element.sticky-session.Master.super_.super_">
        function <span class="apidocSignatureSpan">sticky-session.Master.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sticky-session.Master.super_.prototype" id="apidoc.module.sticky-session.Master.super_.prototype">module sticky-session.Master.super_.prototype</a></h1>




    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype._emitCloseIfDrained" id="apidoc.element.sticky-session.Master.super_.prototype._emitCloseIfDrained">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>_emitCloseIfDrained
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_emitCloseIfDrained = function () {
  debug('SERVER _emitCloseIfDrained');

  if (this._handle || this._connections) {
    debug('SERVER handle? %j   connections? %d',
          !!this._handle, this._connections);
    return;
  }

  process.nextTick(emitCloseNT, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype._listen2" id="apidoc.element.sticky-session.Master.super_.prototype._listen2">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>_listen2
        <span class="apidocSignatureSpan">(address, port, addressType, backlog, fd)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_listen2 = function (address, port, addressType, backlog, fd) {
  debug('listen2', address, port, addressType, backlog, fd);

  // If there is not yet a handle, we need to create one and bind.
  // In the case of a server sent via IPC, we don't need to do this.
  if (this._handle) {
    debug('_listen2: have a handle already');
  } else {
    debug('_listen2: create a handle');

    var rval = null;

    if (!address &amp;&amp; typeof fd !== 'number') {
      rval = createServerHandle('::', port, 6, fd);

      if (typeof rval === 'number') {
        rval = null;
        address = '0.0.0.0';
        addressType = 4;
      } else {
        address = '::';
        addressType = 6;
      }
    }

    if (rval === null)
      rval = createServerHandle(address, port, addressType, fd);

    if (typeof rval === 'number') {
      var error = exceptionWithHostPort(rval, 'listen', address, port);
      process.nextTick(emitErrorNT, this, error);
      return;
    }
    this._handle = rval;
  }

  this._handle.onconnection = onconnection;
  this._handle.owner = this;

  var err = _listen(this._handle, backlog);

  if (err) {
    var ex = exceptionWithHostPort(err, 'listen', address, port);
    this._handle.close();
    this._handle = null;
    process.nextTick(emitErrorNT, this, ex);
    return;
  }

  // generate connection key, this should be unique to the connection
  this._connectionKey = addressType + ':' + address + ':' + port;

  // unref the handle if the server was unref'ed prior to listening
  if (this._unref)
    this.unref();

  process.nextTick(emitListeningNT, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype._setupSlave" id="apidoc.element.sticky-session.Master.super_.prototype._setupSlave">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>_setupSlave
        <span class="apidocSignatureSpan">(socketList)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setupSlave = function (socketList) {
  this._usingSlaves = true;
  this._slaves.push(socketList);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.address" id="apidoc.element.sticky-session.Master.super_.prototype.address">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>address
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">address = function () {
  if (this._handle &amp;&amp; this._handle.getsockname) {
    var out = {};
    this._handle.getsockname(out);
    // TODO(bnoordhuis) Check err and throw?
    return out;
  } else if (this._pipeName) {
    return this._pipeName;
  } else {
    return null;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.close" id="apidoc.element.sticky-session.Master.super_.prototype.close">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  function onSlaveClose() {
    if (--left !== 0) return;

    self._connections = 0;
    self._emitCloseIfDrained();
  }

  if (typeof cb === 'function') {
    if (!this._handle) {
      this.once('close', function() {
        cb(new Error('Not running'));
      });
    } else {
      this.once('close', cb);
    }
  }

  if (this._handle) {
    this._handle.close();
    this._handle = null;
  }

  if (this._usingSlaves) {
    var self = this;
    var left = this._slaves.length;

    // Increment connections to be sure that, even if all sockets will be closed
    // during polling of slaves, `close` event will be emitted only once.
    this._connections++;

    // Poll slaves
    this._slaves.forEach(function(slave) {
      slave.close(onSlaveClose);
    });
  } else {
    this._emitCloseIfDrained();
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.getConnections" id="apidoc.element.sticky-session.Master.super_.prototype.getConnections">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>getConnections
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getConnections = function (cb) {
  function end(err, connections) {
    process.nextTick(cb, err, connections);
  }

  if (!this._usingSlaves) {
    return end(null, this._connections);
  }

  // Poll slaves
  var left = this._slaves.length;
  var total = this._connections;

  function oncount(err, count) {
    if (err) {
      left = -1;
      return end(err);
    }

    total += count;
    if (--left === 0) return end(null, total);
  }

  this._slaves.forEach(function(slave) {
    slave.getConnections(oncount);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.listen" id="apidoc.element.sticky-session.Master.super_.prototype.listen">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>listen
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">listen = function () {
  var self = this;

  var lastArg = arguments[arguments.length - 1];
  if (typeof lastArg === 'function') {
    self.once('listening', lastArg);
  }

  var port = toNumber(arguments[0]);

  // The third optional argument is the backlog size.
  // When the ip is omitted it can be the second argument.
  var backlog = toNumber(arguments[1]) || toNumber(arguments[2]);

  if (arguments.length === 0 || typeof arguments[0] === 'function') {
    // Bind to a random port.
    listen(self, null, 0, null, backlog);
  } else if (arguments[0] !== null &amp;&amp; typeof arguments[0] === 'object') {
    var h = arguments[0];
    h = h._handle || h.handle || h;

    if (h instanceof TCP) {
      self._handle = h;
      listen(self, null, -1, -1, backlog);
    } else if (typeof h.fd === 'number' &amp;&amp; h.fd &gt;= 0) {
      listen(self, null, null, null, backlog, h.fd);
    } else {
      // The first argument is a configuration object
      if (h.backlog)
        backlog = h.backlog;

      if (typeof h.port === 'number' || typeof h.port === 'string' ||
          (typeof h.port === 'undefined' &amp;&amp; 'port' in h)) {
        // Undefined is interpreted as zero (random port) for consistency
        // with net.connect().
        assertPort(h.port);
        if (h.host)
          listenAfterLookup(h.port | 0, h.host, backlog, h.exclusive);
        else
          listen(self, null, h.port | 0, 4, backlog, undefined, h.exclusive);
      } else if (h.path &amp;&amp; isPipeName(h.path)) {
        const pipeName = self._pipeName = h.path;
        listen(self, pipeName, -1, -1, backlog, undefined, h.exclusive);
      } else {
        throw new Error('Invalid listen argument: ' + h);
      }
    }
  } else if (isPipeName(arguments[0])) {
    // UNIX socket or Windows pipe.
    const pipeName = self._pipeName = arguments[0];
    listen(self, pipeName, -1, -1, backlog);

  } else if (arguments[1] === undefined ||
             typeof arguments[1] === 'function' ||
             typeof arguments[1] === 'number') {
    // The first argument is the port, no IP given.
    assertPort(port);
    listen(self, null, port, 4, backlog);

  } else {
    // The first argument is the port, the second an IP.
    assertPort(port);
    listenAfterLookup(port, arguments[1], backlog);
  }

  function listenAfterLookup(port, address, backlog, exclusive) {
    require('dns').lookup(address, function(err, ip, addressType) {
      if (err) {
        self.emit('error', err);
      } else {
        addressType = ip ? addressType : 4;
        listen(self, ip, port, addressType, backlog, undefined, exclusive);
      }
    });
  }

  return self;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var cluster = require('cluster'); // Only required if you want the worker id
var sticky = require('sticky-session');

var server = require('http').createServer(function(req, res) {
  res.end('worker: ' + cluster.worker.id);
});

if (!sticky.<span class="apidocCodeKeywordSpan">listen</span>(server, 3000)) {
  // Master code
  server.once('listening', function() {
    console.log('server started on 3000 port');
  });
} else {
  // Worker code
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.listenFD" id="apidoc.element.sticky-session.Master.super_.prototype.listenFD">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>listenFD
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function deprecated() {
  warned = exports.printDeprecationMessage(msg, warned, deprecated);
  if (new.target) {
    return Reflect.construct(fn, arguments, new.target);
  }
  return fn.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.ref" id="apidoc.element.sticky-session.Master.super_.prototype.ref">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>ref
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ref = function () {
  this._unref = false;

  if (this._handle)
    this._handle.ref();

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sticky-session.Master.super_.prototype.unref" id="apidoc.element.sticky-session.Master.super_.prototype.unref">
        function <span class="apidocSignatureSpan">sticky-session.Master.super_.prototype.</span>unref
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unref = function () {
  this._unref = true;

  if (this._handle)
    this._handle.unref();

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>